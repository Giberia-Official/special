<!DOCTYPE html>
<html>

  <!-- HELLO DEAR INSPECTOR -->
  <!-- I AM THE CREATOR OF THIS PROGRAM, Tata Li (李奥) -->
  <!-- If you have any questions or suggestions, contact me via just4spam123@outlook.com -->

  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Planner</title>
    <link rel="icon" href="./favicon-planner-4.png"  type="image/x-icon">
    <style>

    input[class="borderRI" i]
    {
      border-radius: 40px;
      background-color: white;
      border-color: black;
      border-width: 1.2px;
        padding: 10px 60px;
        padding-top: 10px;
        padding-right: 60px;
        padding-bottom: 10px;
        padding-left: 10px;
      width: 140px;
    }

    a, h3, h2, h1, h4, h5, h6, div, p, button, input{
      font-family: avenir;
    }

    .buttonR
      {
        border-radius: 40px;
        background-color: white;
        border-color: black;
        border-width: 1.2px;
        padding: 8px 15px;
        width: 220px;
        height: 40px;
      }

      .buttonBar
      {
        border-top-left-radius: 20px;
        border-bottom-left-radius: 20px;
        border-top-right-radius: 0px;
        border-bottom-right-radius: 0px;
        background-color: white;
        border-color: black;
        border-width: 1.2px;
        padding: 8px 15px;
        height:60px;
        width:500px;
        text-align:left;

      }

      .calendar
      {
        border-top-left-radius: 0px;
        border-bottom-left-radius: 0px;
        border-top-right-radius: 20px;
        border-bottom-right-radius: 20px;
        background-color: white;
        border-color: black;
        border-width: 1.2px;
        border-left-width: 0px;
        padding: 8px 15px;
        position: relative;
          bottom: -4.5px;
        height:60px;
        width:60px;
        text-align:center;
        font-weight: bold;
        font-size: 30px;
      }
    
      .rectangle {
        height: 5000px;
        width: 25%;
        opacity: 0;
        border-radius: 40px;
      }

      .funrectangle {
        background-color: #FAF0FF;
        border-color: #FDF9FF;
        border-style: initial;
        border-width: 2px;
        height: 10000px;
        width: 360px;
        border-radius: 40px;
        z-index: -1;
        position: absolute;
          top: -230px;
          left: 50px;
      }

      .tagBar
      {
        border-top-left-radius: 5px;
        border-bottom-left-radius: 5px;
        border-top-right-radius: 5px;
        border-bottom-right-radius: 5px;
        background-color: white;
        border-color: black;
        border-width: 1.2px;
        height:25px;
        text-align:center;
        font-weight: bold;
      }

    </style>

  </head>


  <body style="background-color: white;" onload="Get()">

    <div style="float:left; width: 35%; position: absolute; left: 80px">

      <br/><br/>   
      <h1>Add Task</h1>

      <br/>

      <button type="button" class="buttonR" id="subjectButton" style="width:80px; height: 40px; text-align: left; border-top-right-radius: 0px;border-bottom-right-radius: 0px;"><big>Subject</big></button>
      <button type="button" class="buttonR" style="height: 40px; width:140px; text-align: left; border-top-left-radius: 0px;border-bottom-left-radius: 0px; position: relative; right: 10px; bottom: 0.5px; border-left-width:0px">
      <form>
        <select id="subject">
          <option value = ""> None </option>
          <option value = "Science"> Science </option>
          <option value = "Math"> Math </option>
          <option value = "Chinese"> Chinese </option>
          <option value = "English"> English </option>
          <option value = "Humanities"> Humanities </option>
          <option value = "Design"> Design </option>
          <option value = "Drama"> Drama </option>
          <option value = "Art"> Art </option>
          <option value = "Music"> Music </option>
          <option value = "PE"> PE </option>
        </select>
      </form>
      </button>

      <br/>
      <br/>

      <input class="borderRI" placeholder="Task" id="task" maxlength="40" /><br/><br/>
      <input type="date" class="borderRI" id="date" placeholder="Date (yyyy-mm-dd)" minlength="10"/><br/><br/>

      <button type="button" class="buttonR" id="tagButton" style="width:80px; height: 40px; text-align: left; border-top-right-radius: 0px;border-bottom-right-radius: 0px;"><big>Tag</big></button>
      <button type="button" class="buttonR" style="height: 40px; width:140px; text-align: left; border-top-left-radius: 0px;border-bottom-left-radius: 0px; position: relative; right: 10px; bottom: 0.5px; border-left-width:0px">
      <form>
        <select id="tag">
          <option value = "None"> None </option>
          <option value = "SUMM"> Summative </option>
          <option value = "FORM"> Formative </option>
          <option value = "Prior"> Prior </option>
          <option value = "Important"> Important </option>
        </select>
      </form>
      </button>

      <br/>
      <br/>

      <button type="button" class="buttonR" onclick="Create()" id="submit"><b><big>Add New Task</big></b></button>
      
      <!--
      <br/><br/>
      <button class="buttonR" onclick="SavenStore()"><b><big>Save and Store</big></b></button> -->

      <br/><br/>
      <button class="buttonR" onclick="schedule()" id="viewScheduleButton" style="opacity: 1"><b><big>View Schedule</big></b></button>

      <br/><br/>
      <button class="buttonR" onclick="ClearForm()"><b><big>Clear Form</big></b>

      <br/><br/>
      <button class="buttonR" onclick="closeSchedule()" id="closeScheduleButton" style="opacity: 0; position: relative; top: 0px"><b><big>Close Schedule</big></b></button>


      <script>

        let idList = [0];
        var frontpartnum = 2200;
        var backpartnum = 0;
        var tasksList = document.getElementById("tasks");

        function ClearForm(){
          document.getElementById("task").value = "";
          document.getElementById("date").value = "";
          document.getElementById("tag").value = "None";
          document.getElementById("subject").value = "";
        }

        function Create()
        {
          tasksList = document.getElementById("tasks");
          let subjectVal = document.getElementById("subject");
          let tag = document.getElementById("tag");
          let tagVal = tag.value;

          let subjectRaw = subjectVal.value;
          let subject = "<big><b>"+ (subjectVal.value) +"</b></big>";
          let task = "<big>" + document.getElementById("task").value + "</big>";

          let dateStr = (document.getElementById("date").value);
          let dateArray = dateStr.split("-");
          let day = parseInt(dateArray[2]);
          let month = parseInt(dateArray[1]);
          let year = parseInt(dateArray[0]);
          //alert(subject);
          //I AM THE CREATOR OF THIS PROGRAM, Tata Li (李奥)

          let newTask = document.createElement("button");
          let newDate = document.createElement("button");
          let newTag;
          let newBreak = document.createElement("br");
          newTask.setAttribute("class","buttonBar");
          newDate.setAttribute("class","calendar");

          if (tagVal == "None"){
            console.log("no tag");
            newTag = document.createElement("div");
            newTag.innerHTML = ("<button style=\"position: relative; z-index: -3; bottom: 54px; left: 450px; opacity: 1;\" class=\"tagBar\">"+tagVal+"</button>");
          } else {
            newTag = document.createElement("div");
            //newTag.innerHTML = String(tagVal);
            //newTag.setAttribute("class", "tagBar");
            if (tagVal == "Prior"){
              newTag.innerHTML = ("<button style='position: relative; z-index: 3; bottom: 54px; left: 450px; opacity: 1;' class='tagBar'>"+tagVal+"</button>");
            } else if (tagVal == "FORM"){
              //newTag.setAttribute("style", "position: relative; z-index: 3; bottom: 12px; left: -122px; opacity: 1;")
              newTag.innerHTML = ("<button style='position: relative; z-index: 3; bottom: 54px; left: 440px; opacity: 1;' class='tagBar'>"+tagVal+"</button>");
            } else if (tagVal == "SUMM"){
              newTag.innerHTML = ("<button style='position: relative; z-index: 3; bottom: 54px; left: 438px; opacity: 1;' class='tagBar'>"+tagVal+"</button>");
            } else if (tagVal == "Important"){
              newTag.innerHTML = ("<button style='position: relative; z-index: 3; bottom: 54px; left: 418px; opacity: 1;' class='tagBar'>"+tagVal+"</button>");
            }
          }

          let newid = (9000000000000 + year*100000000 + month*1000000 + day*10000 + backpartnum*10);
          backpartnum += 1;
          if (Number.isInteger(newid)==false){
            frontpartnum += 1;
            newid = (9000000000000+frontpartnum*100000000+(Math.floor(Math.random() * 999))*10);
            day = 0;
          }

          newTask.setAttribute("id", String(newid));
          newTask.setAttribute("onclick", "Destroy("+String(parseInt(newid/10))+")");
          newDate.setAttribute("onclick", "Pin("+String(parseInt(newid/10))+")");
          newDate.setAttribute("id", String(newid+1));
          newTag.setAttribute("id", String(newid+2));

          idList.push(newid);
          if (idList[0] == 0){
            idList.splice(0, 1);
          }
          idList.sort();
          console.log(newid);
          let idIndex = idList.indexOf(newid);
          console.log(idList);

          if (subjectRaw == "Science"){
            newTask.setAttribute('style','background-color: #CDF6C0;');
          } else if (subjectRaw == "Math"){
            newTask.setAttribute('style','background-color: #F5F8C3;');
          } else if (subjectRaw == "English"){
            newTask.setAttribute('style','background-color: #F7B79B;');
          } else if (subjectRaw == "Chinese"){
            newTask.setAttribute('style','background-color: #C0CAF6;');
          } else if (subjectRaw == "Humanities"){
            newTask.setAttribute('style','background-color: #C0E9F6;');
          } else if (subjectRaw == "Design"){
            newTask.setAttribute('style','background-color: #FAB4F6;');
          } else if (subjectRaw == "Drama"){
            newTask.setAttribute('style','background-color: #F6C0C4;');
          } else if (subjectRaw == "Music"){
            newTask.setAttribute('style','background-color: #F6C0C4;');
          } else if (subjectRaw == "Art"){
            newTask.setAttribute('style','background-color: #F6C0C4;');
          } else if (subjectRaw == "PE"){
            newTask.setAttribute('style','background-color: #B8FFF8');
          } else {
            newTask.setAttribute('style','background-color: white;');
          }

          //I AM THE CREATOR OF THIS PROGRAM, Tata Li (李奥)

          if (subjectRaw != ""){
            newTask.innerHTML = subject + ": " + task;
          } else{
            newTask.innerHTML = task + "&nbsp";
          }
          newDate.innerHTML = day;

          //alert(idIndex);
          tasksList.insertBefore(newTask, tasksList.children[idIndex*3]);
          tasksList.insertBefore(newDate, tasksList.children[idIndex*3+1]);
          tasksList.insertBefore(newTag, tasksList.children[idIndex*3+2]);

          //tasksList.appendChild(newTask);
          //tasksList.appendChild(newBreak);
          //tasksList.appendChild(newBreak2);
          //alert("Task Added!");

        }


        function Pin(id){
          //document.addEventListener('contextmenu', event => event.preventDefault());
          //alert('im right clicked');
          let date = document.getElementById(String(id)+"1");
          let tag = document.getElementById(String(id)+"2");
          let newid = parseInt(id)*10;
          let item = document.getElementById(String(id)+"0");
          let idIndex = idList.indexOf(newid);
          // idList = this.idList;
          // tasksList = this.tasksList;


          if (newid > 7000000000000){
            alert("Task Pinned!");
            newid = newid-5000000000000;
            item.setAttribute("onclick", "Destroy("+String(parseInt(newid/10))+")");
            date.setAttribute("onclick", "Pin("+String(parseInt(newid/10))+")");
            item.setAttribute("id", String(newid));
            date.setAttribute("id", String(newid+1));
            tag.setAttribute("id", String(newid+2));
            date.setAttribute("style","color: #db0000");
            console.log("newid has changed");
            console.log(item.outerHTML);
            console.log(newid);

            var idx = idList.indexOf(newid+5000000000000);
            idList.splice(idx, 1, newid);

            idList.sort();
            console.log("idList is rearranged");
            console.log(idList);
            idIndex = idList.indexOf(newid);

            //alert(idIndex);
            tasksList.insertBefore(item, tasksList.children[idIndex*3]);
            tasksList.insertBefore(date, tasksList.children[idIndex*3+1]);
            tasksList.insertBefore(tag, tasksList.children[idIndex*3+2]);

          } else {
            alert("Task Unpinned!");
            newid = newid+5000000000000;
            item.setAttribute("onclick", "Destroy("+String(parseInt(newid/10))+")");
            date.setAttribute("onclick", "Pin("+String(parseInt(newid/10))+")");
            item.setAttribute("id", String(newid));
            date.setAttribute("id", String(newid+1));
            tag.setAttribute("id", String(newid+2))
            date.setAttribute("style","color: black");
            console.log("newid has changed");
            console.log(item.outerHTML);

            let idx = idList.indexOf(newid-5000000000000);
            idList.splice(idx, 1, newid);

            idList.sort();
            console.log("idList is rearranged");
            console.log(idList);
            let idIndex = idList.indexOf(newid)+1;
            
            //alert(idIndex);
            tasksList.insertBefore(item, tasksList.children[idIndex*3]);
            tasksList.insertBefore(date, tasksList.children[idIndex*3]);
            tasksList.insertBefore(tag, tasksList.children[idIndex*3]);
          }
        }

        function Destroy(id)
        {
          alert("Task Deleted!\nEdit task in the purple form on the left of window");

          //alert(id);
          var item = document.getElementById(String(id)+"0");
          var date = document.getElementById(String(id)+"1");
          var tag = document.getElementById(String(id)+"2");
          var tasksList = document.getElementById("tasks");

          var idstr = String(id)+"0";
          var taskpart = JSON.stringify(document.getElementById(String(id)+"0").innerHTML);
          
          var hasSubject = false;
          for (var i = 0; i<taskpart.length; i+=1){
            if (taskpart[i]==":"){
              var subjectpart = taskpart.substring(9, i-10);
              var contentpart = taskpart.substring(i+7, taskpart.length-7);
              hasSubject = true;
            }
          } 

          if (!hasSubject){
            var contentpart = taskpart.substring(6, taskpart.length-13);
            var subjectpart = "";
          }

          if (idstr.substring(5,9)=="0000"){
            var datepart = "";
          }
          var datepart = idstr.substring(1, 5)+"-"+idstr.substring(5, 7)+"-"+idstr.substring(7, 9);
          //alert(datepart)

          document.getElementById("task").value = contentpart;
          document.getElementById("subject").value = subjectpart;
          document.getElementById("date").value = datepart;

          tasksList.removeChild(item);
          tasksList.removeChild(date);
          tasksList.removeChild(tag);

          var idIndex = idList.indexOf(parseInt(id*10));
          // alert(idList)
          // alert(idIndex)
          idList.splice(idIndex, 1);
          console.log(idList);
        }

      </script>

      <br/>
      <div class="rectangle" style="height: 4600px;"></div>
      <div class="rectangle"></div>
      <p style="font-family: times;">© 2022 Tata Li</p>

    </div>

    <div style="position: absolute; left: 400px;">


      <p style="font-family: times; text-align: right;"><small>v1.0611.1615</small></p>

      <h1> Digital Planner </h1>
      <div id="tasks"></div>

    </div>

    <div>
      <script>

        let storedItem = localStorage.getItem("storedItem");
        let storedItem2 = localStorage.getItem("idList");

        function SavenStore(){
          let item = document.getElementById("tasks");
          var newItem = item.innerHTML;
        
          let newItemSeparate = newItem.split("\\");
          //console.log(newItemSeparate);
          var newestItem;
          //console.log(newItemSeparate.length);
          for (var i = 0; i < newItemSeparate.length; i += 1) {
            newestItem = newestItem + newItemSeparate[i];
          }

          //console.log(newestItem);
          //alert(idList);
          //alert("Planner Backed Up!")
          localStorage.setItem("storedItem", newestItem);
          localStorage.setItem("idList", idList);

        }

        function Get(){
          console.log(storedItem);
          console.log(storedItem2);
          localStorage.getItem("storedItem");

          if (storedItem == null || storedItem == "true"){
            alert("Are you new to this planner?");
            document.getElementById("tasks").innerHTML = ""
            idList = [0];
            tasksList = document.getElementById("tasks");

          } else {
            document.getElementById("tasks").innerHTML = storedItem.substr(9, storedItem.length);
            localStorage.getItem("idList");
            idList = storedItem2.split(',');

            for (var i=0; i<idList.length; i+=1){
              idList[i] = parseInt(idList[i]);
            }

            tasksList = document.getElementById("tasks");

          }
          
        }

      </script>

    </div>

    <div>
      <div class="funrectangle" style="width: 300px; position: absolute; left: 40px"></div>
      <!--<div class="funrectangle" style="height:30px; width: 300px; position: absolute; top: 120px; left: 380px; z-index: 2; background-color: white;"></div>-->
    </div>

    <div>

      <img src="schedule3.png" alt="i'm confused" id="scheduleImage" style="width: 820px; opacity: 0; z-index: -750; position: absolute; left: -1000px; top: 5000px;"/>

      <script>

        let scheduleOpen = false;

        function schedule(){
          if (scheduleOpen == false){
            scheduleOpen = true;
            viewSchedule();
            console.log(scheduleOpen);
          } else {
            scheduleOpen = false;
            closeSchedule();
          }
        }

        function viewSchedule(){
          let schedule = document.getElementById("scheduleImage");
          let closeButton = document.getElementById("closeScheduleButton");
          let viewButton = document.getElementById("viewScheduleButton")
          schedule.setAttribute("style", "width: 820px; opacity: 1; position: absolute; top: 100px; right: 10px; z-index: 4;");
          viewButton.innerHTML = "<b><big>Close Schedule</big></b>";
        }

        function closeSchedule(){
          let schedule = document.getElementById("scheduleImage");
          let closeButton = document.getElementById("closeScheduleButton");
          let viewButton = document.getElementById("viewScheduleButton");
          schedule.setAttribute("style", "width: 820px; opacity: 0.5; position: absolute; left: -1000px; z-index: -4;");
          viewButton.innerHTML = "<b><big>View Schedule</big></b>";
        }
      </script> 

    </div>

    <div> <!--failed notification-->
      <script>
        
        if (Notification.permission === "granted"){
          console.log("We have permission to send notifications");
          Send("PLANNER", "Notification permission is granted!");
        } else if (Notification.permission !== "denied"){
          Notification.requestPermission().then(permission => {console.log(permission);});
        }

        function Send(title, text){
          var img = "./favicon-planner-4.png"
          var notification = new Notification(title, { body: text, icon: img);
          console.log("Notification sent")
        }

      </script>
    </div>
    <div>
      
      <h1 id='dateDisplay' style="font-weight: lighter; position: absolute; top: 36px; left:800px; color: grey"><small><small>IDK 00 - 00:00</small></small></h1>

      <script>
        updateHello();

        setInterval(function(){updateHello()}, 30000);
        setInterval(function(){SavenStore()}, 5000);

        function updateHello(){
          let text = document.getElementById("dateDisplay");
          let date = new Date();
          let newDate = JSON.stringify(date);
          let month = newDate.slice(6,8);
          let day = newDate.slice(9,11);
          let time = newDate.slice(12,17);
          let newHour = String(parseInt(time.slice(0,2)) + 8);
          if (newHour > 23.5){
            newHour = String(parseInt(newHour) - 24);
          }
          let newNoHour = time.slice(2,6);
          let newTime = newHour + newNoHour;
          let week = newDate.slice(11,12);
          let newMonth;

          if (month == '01'){
            newMonth = 'Jan';
          } else if (month == '02'){
            newMonth = 'Feb';
          } else if (month == '03'){
            newMonth = 'Mar';
          } else if (month == '04'){
            newMonth = 'Apr';
          } else if (month == '05'){
            newMonth = 'May';
          } else if (month == '06'){
            newMonth = 'Jun';
          } else if (month == '07'){
            newMonth = 'Jul';
          } else if (month == '08'){
            newMonth = 'Aug';
          } else if (month == '09'){
            newMonth = 'Sep';
          } else if (month == '10'){
            newMonth = 'Oct';
          } else if (month == '11'){
            newMonth = 'Nov';
          } else if (month == '12'){
            newMonth = 'Dec';
          } else {
            newMonth = 'IDK';
          }

          if (day[1] == "1" && day!="11"){
            newDaySup = "<sup>st</sup>";
          } else if (day[1] == "2" && day!="12"){
            newDaySup = "<sup>nd</sup>";
          } else if (day[1] == "3" && day!="13"){
            newDaySup = "<sup>rd</sup>";
          } else {
            newDaySup = "<sup>th</sup>";
          }

          text.innerHTML = "<small><small>" + newMonth + "&nbsp" + day + newDaySup + "&nbsp-&nbsp" + newTime + "</small></small>";
        }
      </script>

    </div>

  </body>
</html>
